---
title: "依存性注入とは依存性を注入するということです。"
emoji: "🚀"
type: "tech"
topics: []
published: false
---

## 1. 背景
実務において、以下のようなコードがあり、初めて見た記述方法だったため調べたところ、DIという概念のことでした。
```php
public function メソッド名(クラス名 $〇〇) {
    // 処理
}
```
今回は、DIやサービスコンテナ、サービスプロバイダについて、調査した内容をもとに記事という形でアウトプットします。

調査を進めていく中で、以下のようなコードは意識せずに使っていたことを思い出しました。このRequestもおそらくDIを使用した記述方法だったのだろうと感じました。
```php
public function store(Request $request) {
    // 処理
}
```
## DI(Dependency Injection, 依存性注入)とは？
DIとは、**あるクラスが別のクラスを直接インスタンス化せず、外部からそのクラスのインスタンスを受け取ること**です。メソッドの引数にタイプヒンティング形式で記述して使用します。(DIにおいてインスタンス化する仕組みは複雑なため、今回は省略しますが、今後記事を作成したいと思っています。)

以下は、クラスA内でのクラスBの呼び出し方を説明した図です。図をもとにそれぞれ詳しく説明します。

![](https://storage.googleapis.com/zenn-user-upload/0590a1652471-20240929.png)
*図1 クラス内での別クラスの呼び出し方とDIの種類*

クラスを呼び出す方法には、主に **直接インスタンス化** と **DI(依存性注入)** の2種類があります。
- 直接インスタンス化
    クラス内で次のようにnewキーワードを使ってインスタンスを生成します。
    ```php
    public function メソッド名() {
        $〇〇 = new クラスB;
        // $〇〇->メソッド名で処理を実行します
    }
    ```

- DI(依存性注入)
    メソッドの引数やコンストラクタに他のクラスを受け取り(タイプヒンティング)、そのクラスのインスタンスを利用します。
    ```php
    public function メソッド名(クラスB $〇〇) {
        // $this->$〇〇->メソッド名で処理を実行します
    }
    ```
上記のように、どちらの方法でもクラスのインスタンスを生成し、利用できます。直接インスタンス化は一般的な方法であり、独学で学んでいるとDIを意識せずに開発を進んでしまうことも多いです。そのため、「なぜわざわざDIを使う必要があるのか」と疑問に感じるかもしれませんが、これには重要な理由があります。

### DIを使う理由

また、図１の通り、DIにはメソッドインジェクションとコンストラクタインジェクションの2種類の方法があります。
- メソッドインジェクション
    メソッドの引数として依存クラスを渡す方法です。以下の例のように、メソッドを呼び出す際にクラスBを渡し、その中で処理を実行します。
    ```php
    public function メソッド名(クラスB $〇〇) {
        // $this->$〇〇->メソッド名で処理を実行します
    }
    ```
    この方法では、特定のメソッド内だけでクラスBを利用したい場合に有効です。例えば、一時的な依存性を注入したいときや、処理ごとに異なる依存オブジェクトを渡したい時に便利です。

- コンストラクタインジェクション
    __constructメソッドで依存クラスを受け取り、プロパティとして保持する方法です。$this->〇〇に代入しプロパティ化しておくことで、異なるメソッドにおいてもクラスBのメソッドを利用することができます。
    ```php
    public function __construct(クラスB $〇〇) {
        $this->〇〇 = $〇〇;
        // 上記のようにプロパティ化しておくことで、クラスAの他のメソッド内でも、
        // $this->〇〇->メソッド名()が使えます
    }
    ```
    この方法では、クラスAをインスタンス化する際に、クラスBも自動的に注入されるため、クラス全体でクラスBの機能を利用できるようになります。よって、クラスAの複数のメソッドで同じクラスBを利用したい場合や、クラス全体に共通する依存関係がある場合に適しています。

    つまり、メソッドインジェクションとコンストラクタインジェクションの使い分けは、依存するクラスを **「特定のメソッドのみで使うか」** それとも **「クラス全体で使うか」** によって判断します。




## DIを用いるメリット
テストを記述する際に、テスト用のクラスを簡単に呼び出すことができる。


## サービスコンテナとは？
サービスコンテナとは、サービスを保管しておく概念のことです。

## サービスプロバイダとは？
サービスプロバイダとは、サービスコンテナに登録するためのファイル群のこと。Laravelではapp/Providers/AppServiceProvider.phpが該当します。


DI とは依存性注入の略称で
