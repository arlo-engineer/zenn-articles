---
title: "PHPUnitによる単体テストを書いてみた"
emoji: "🗂"
type: "tech"
topics: []
published: false
---

## PHPUnitのインストール
以下を実行し、PHPUnitをインストールします。
```
composer require --dev phpunit/phpunit
```

## テストの実行方法
```
vendor/bin/phpunit <テストディレクトリ名やファイル名>
```
## 実行による出力結果の意味
https://docs.phpunit.de/en/11.3/textui.html#outcome-and-issues

## phpunit.xmlとは？
phpunit.xmlはPHPUnitの設定ファイルで、オプションやテストスイートを設定できる。設定ファイルで定義することで実行時のオプションを省くことができる。
### どんなオプションがあるのか？
テスト実行コマンドの後ろに記述し、テストの実行を細かく制御することができる。
具体的には以下のオプションが存在する。
- --bootstrap <ファイル名>: テストの実行前に含めるPHPスクリプトを指定できる。基本的に、PHPがテスト対象のコード単位を見つけられるようにするためのオートローダのみ指定される。
・「PHPがテスト対象のコード単位を見つけられるようにするためのオートローダ」？？
### vendor/autoload.phpを紐解く
```php:autoload.php
<?php

// autoload.php @generated by Composer

// ✅PHP5.6未満のバージョンの際に実行する
if (PHP_VERSION_ID < 50600) {
    // ✅HTTP headerが正常に送信されたかを確認→送信されていなかった場合、サーバーエラーを表示する
    if (!headers_sent()) {
        header('HTTP/1.1 500 Internal Server Error');
    }
    // ✅PHPまたはComposerのバージョンが古い場合、アップデートを促す
    $err = 'Composer 2.3.0 dropped support for autoloading on PHP <5.6 and you are running '.PHP_VERSION.', please upgrade PHP or use Composer 2.2 LTS via "composer self-update --2.2". Aborting.'.PHP_EOL;
    // ✅php.iniで定義されたdisplay_error(エラー文の表示/非表示切り替えに使用)が無効の場合実行
    if (!ini_get('display_errors')) {
        if (PHP_SAPI === 'cli' || PHP_SAPI === 'phpdbg') {
            fwrite(STDERR, $err);
        } elseif (!headers_sent()) {
            echo $err;
        }
    }
    // ✅$errのエラー文を出力する
    trigger_error(
        $err,
        E_USER_ERROR
    );
}

// ✅composerが生成したautoload_real.phpを読み込む
require_once __DIR__ . '/composer/autoload_real.php';

return ComposerAutoloaderInitfbee484fbcb98ba45566f17e8eb69e9b::getLoader();
```
#### HTTP headerとは？

- --dont-report-useless-tests: 
- --disallow-test-output: 
- --testsuite:

その他のオプションについては、公式ドキュメントを参考にしてみてください。
https://docs.phpunit.de/en/11.3/textui.html#command-line-options

### テストスイートとは？
テストの目的や条件が似ている複数のテストケースを一括りにしたもの。
--testsuite 
→一括りにすると
→オプションとはどんなもの？
→`vendor/bin/phpunit tests/CalculatorTest.php --colors`を実行すると結果部分に色がつくが、phpunit.xmlに設定を入力しておくだけで、--colorsオプションを省いた形でテストを実行することができる。
→他にはどんなオプションがあるか？
- --bootstrap:
- --testsuite: 
        


## 参考文献
https://docs.phpunit.de/en/11.3/index.html
https://rakuraku-engineer.com/posts/phpunit/
https://note.com/88gram/n/ncbbd02618f5c